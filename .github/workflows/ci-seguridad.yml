name: üõ°Ô∏è P0 - PRotecci√≥n del Bot√≥n y Despliegue

on:
  push:
    # Desplegar√° solo cuando se haga push a 'main'
    # y solo si 'index.html' cambi√≥.
    branches:
      - main
    paths:
      - 'index.html'
  pull_request:
    # Ejecutar√° solo la prueba (no el despliegue) 
    # en Pull Requests que toquen 'index.html'.
    paths:
      - 'index.html'

jobs:
  # ----------------------------------------------
  # TRABAJO 1: TU PRUEBA (El "Guardia")
  # ----------------------------------------------
  test-conversion-guard:
    name: 1. Verificar Boton Word
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout (Obtener c√≥digo)
        uses: actions/checkout@v4

      - name: Asegurar que el CTA P0 exista
        run: |
          echo "Buscando 'id=\"word\"' en index.html..."
          # grep -q fallar√° el 'step' si no encuentra el texto
          grep -q 'id="word"' index.html 
          echo "‚úÖ √âxito: El bot√≥n esta correcto P0 [OK]."

  # ----------------------------------------------
  # TRABAJO 2: EL DESPLIEGUE (Solo si el Job 1 pasa)
  # ----------------------------------------------
  deploy-to-vercel:
    name: 2. Desplegar en Vercel
    runs-on: ubuntu-latest
    
    # --- ¬°LA MAGIA! ---
    # Este 'job' DEPENDE de que el 'job' anterior
    # llamado 'test-conversion-guard' termine con √©xito.
    needs: test-conversion-guard 
    
    # Condici√≥n extra: Solo despliega si el evento es un 'push'
    # a la rama 'main' (y no un Pull Request).
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'

    steps:
      - name: Checkout (Obtener c√≥digo)
        uses: actions/checkout@v4

      - name: Configurar Node.js (Vercel lo necesita)
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Puedes cambiar esto a 18 o 20

      - name: Desplegar en Vercel (Producci√≥n)
        uses: amondnet/vercel-action@v20
        with:
          # Usa los secretos que configuraste en GitHub
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          # El '--prod' es para publicar en el dominio de producci√≥n
          vercel-args: '--prod'